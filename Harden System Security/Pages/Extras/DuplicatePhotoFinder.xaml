<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="HardenSystemSecurity.Pages.Extras.DuplicatePhotoFinder"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:HardenSystemSecurity.ViewModels"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:core="using:CommonCore"
    xmlns:customUI="using:AppControlManager.CustomUIElements"
    KeyboardAcceleratorPlacementMode="Hidden"
    mc:Ignorable="d">

    <!-- 
        KeyboardAcceleratorPlacementMode="Hidden" prevents the system from automatically showing the tooltip 
        whenever the mouse hovers over this page.
    -->

    <Page.KeyboardAccelerators>
        <KeyboardAccelerator Key="Z" Modifiers="Control" Invoked="{x:Bind ViewModel.UndoInvoked}"/>
    </Page.KeyboardAccelerators>

    <Page.Resources>
        <!-- 
            Custom Button Style for Images: 
            Removes default background/borders but adds a Scale Animation on Press 
            so the user knows they clicked it. 
        -->
        <Style x:Key="ImageButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid x:Name="RootGrid" Background="{TemplateBinding Background}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal"/>
                                    <VisualState x:Name="PointerOver">
                                        <VisualState.Setters>
                                            <!-- a subtle opacity change on hover -->
                                            <Setter Target="ContentPresenter.Opacity" Value="0.9"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState x:Name="Pressed">
                                        <VisualState.Setters>
                                            <!-- key: Scale down to 95% size when pressed -->
                                            <Setter Target="ContentPresenter.RenderTransform">
                                                <Setter.Value>
                                                    <ScaleTransform ScaleX="0.95" ScaleY="0.95" CenterX="75" CenterY="65"/>
                                                    <!-- CenterX/Y roughly middle of 150px/130px image -->
                                                </Setter.Value>
                                            </Setter>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState x:Name="Disabled"/>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter x:Name="ContentPresenter"
                                              Content="{TemplateBinding Content}"
                                              ContentTransitions="{TemplateBinding ContentTransitions}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"
                                              Padding="{TemplateBinding Padding}"
                                              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                              AutomationProperties.AccessibilityView="Raw"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- InfoBar -->
        <customUI:InfoBarV2 x:Name="MainInfoBar"
                            Grid.Row="0"
                            Margin="0,0,0,12"
                            Title="Duplicate Finder"
                            Message="{x:Bind ViewModel.MainInfoBarMessage, Mode=OneWay}"
                            Severity="{x:Bind ViewModel.MainInfoBarSeverity, Mode=OneWay}"
                            IsOpen="{x:Bind ViewModel.MainInfoBarIsOpen, Mode=TwoWay}"
                            IsClosable="{x:Bind ViewModel.MainInfoBarIsClosable, Mode=OneWay}"/>

        <!-- Toolbar Area -->
        <controls:WrapPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalSpacing="2"
                            VerticalSpacing="6"
                            Margin="0,0,0,10">

            <!-- Group 1: I/O selection -->
            <Border CornerRadius="10"
                    Padding="6,4"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="6">

                    <!-- Progress Ring -->
                    <ProgressRing IsActive="True"
                                  VerticalAlignment="Center"
                                  Background="Gray"
                                  IsIndeterminate="{x:Bind ViewModel.IsProgressIndeterminate, Mode=OneWay}"
                                  Value="{x:Bind ViewModel.ScanProgress, Mode=OneWay}" />

                    <!-- Select Files -->
                    <customUI:ButtonV2 IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                       x:Uid="BrowseForPhotosButton"
                                       VerticalAlignment="Center"
                                       ObservedData="{x:Bind ViewModel.SelectedFiles.Count, Mode=OneWay}"
                                       Click="{x:Bind ViewModel.BrowseFiles_Click}">
                        <customUI:ButtonV2.ContentTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7C5;" FontSize="16"/>
                                    <TextBlock Text="{x:Bind}"/>
                                </StackPanel>
                            </DataTemplate>
                        </customUI:ButtonV2.ContentTemplate>
                        <customUI:ButtonV2.Flyout>
                            <Flyout>
                                <controls:WrapPanel Orientation="Vertical" HorizontalSpacing="15" VerticalSpacing="15">
                                    <Button x:Uid="ClearButton" Click="{x:Bind ViewModel.ClearSelectedFiles}">
                                        <Button.ContentTemplate>
                                            <DataTemplate x:DataType="x:String">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <FontIcon Glyph="&#xE894;" FontSize="16"/>
                                                    <TextBlock Text="{x:Bind}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>
                                    <TextBlock x:Uid="ViewSelectedFilesTextBlock" TextWrapping="WrapWholeWords"/>
                                    <customUI:ListBoxV2 MinWidth="400" SelectionMode="Single" ItemsSource="{x:Bind ViewModel.SelectedFiles, Mode=OneWay}"/>
                                </controls:WrapPanel>
                            </Flyout>
                        </customUI:ButtonV2.Flyout>
                    </customUI:ButtonV2>

                    <!-- Select Folders -->
                    <customUI:ButtonV2 IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                       x:Uid="BrowseForFoldersButton"
                                       VerticalAlignment="Center"
                                       ObservedData="{x:Bind ViewModel.SelectedFolders.Count, Mode=OneWay}"
                                       Click="{x:Bind ViewModel.BrowseFolders_Click}">
                        <customUI:ButtonV2.ContentTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xEC50;" FontSize="16"/>
                                    <TextBlock Text="{x:Bind}"/>
                                </StackPanel>
                            </DataTemplate>
                        </customUI:ButtonV2.ContentTemplate>
                        <customUI:ButtonV2.Flyout>
                            <Flyout>
                                <controls:WrapPanel Orientation="Vertical" HorizontalSpacing="15" VerticalSpacing="15">
                                    <Button x:Uid="ClearButton" Click="{x:Bind ViewModel.ClearSelectedFolders}">
                                        <Button.ContentTemplate>
                                            <DataTemplate x:DataType="x:String">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <FontIcon Glyph="&#xE894;" FontSize="16"/>
                                                    <TextBlock Text="{x:Bind}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>
                                    <TextBlock x:Uid="ViewSelectedFilesTextBlock" TextWrapping="WrapWholeWords"/>
                                    <customUI:ListBoxV2 MinWidth="400" SelectionMode="Single" ItemsSource="{x:Bind ViewModel.SelectedFolders, Mode=OneWay}"/>
                                </controls:WrapPanel>
                            </Flyout>
                        </customUI:ButtonV2.Flyout>
                    </customUI:ButtonV2>

                </StackPanel>
            </Border>

            <!-- Group 2: Actions -->
            <Border CornerRadius="10"
                    Padding="6,4"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="6">

                    <!-- Start Scan -->
                    <Button Style="{StaticResource AccentButtonStyle}"
                            VerticalAlignment="Center"
                            x:Uid="StartScanButton"
                            Click="{x:Bind ViewModel.StartScan_Click}"
                            IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}">
                        <Button.ContentTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE768;" FontSize="16"/>
                                    <TextBlock Text="{x:Bind}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <!-- Actions DropDownButton -->
                    <DropDownButton VerticalAlignment="Center"
                                    x:Uid="ExtraActionsDropDownButton"
                                    IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}">
                        <DropDownButton.ContentTemplate>
                            <DataTemplate x:DataType="x:String">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE712;" FontSize="16"/>
                                    <TextBlock Text="{x:Bind}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DropDownButton.ContentTemplate>

                        <DropDownButton.Flyout>
                            <MenuFlyout Placement="Bottom">

                                <!-- Undo Button -->
                                <MenuFlyoutItem x:Uid="UndoLastDeletionMenuFlyoutItem"
                                                IsEnabled="{x:Bind ViewModel.IsUndoEnabled, Mode=OneWay}"
                                                Click="{x:Bind ViewModel.Undo_Click}"
                                                KeyboardAcceleratorTextOverride="Ctrl + Z">
                                    <!-- Setting the KeyboardAcceleratorTextOverride here because the entire page accepts CTRL + Z shortcuts and this is just a UI indicator for the user to know. -->
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE7A7;" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutSeparator/>

                                <!-- Auto Delete All Duplicates -->
                                <MenuFlyoutItem x:Uid="AutoDeleteAllDuplicatesMenuFlyoutItem"
                                                Click="{x:Bind ViewModel.AutoDeleteAll_Click}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE74D;" Foreground="Red"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutSeparator/>

                                <!-- Clear Data -->
                                <MenuFlyoutItem x:Uid="ClearDataMenuFlyoutItem"
                                                Click="{x:Bind ViewModel.ClearData_Click}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE894;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                            </MenuFlyout>
                        </DropDownButton.Flyout>
                    </DropDownButton>

                </StackPanel>
            </Border>

            <!-- Group 3: Search -->
            <Border CornerRadius="10"
                    Padding="6,4"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    VerticalAlignment="Center">
                <TextBox x:Uid="SearchBoxTextBox"
                         VerticalAlignment="Center"
                         BorderThickness="0"
                         Background="Transparent"
                         Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            </Border>

            <!-- Group 4: Statistics -->
            <Border CornerRadius="10"
                    Padding="6,4"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    VerticalAlignment="Center">

                <Button VerticalAlignment="Center"
                        BorderThickness="0"
                        x:Uid="StatisticsButton"
                        Background="Transparent">
                    <Button.ContentTemplate>
                        <DataTemplate x:DataType="x:String">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE9D9;" FontSize="16"/>
                                <TextBlock Text="{x:Bind}"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                    <Button.Flyout>
                        <Flyout Placement="Bottom">
                            <Flyout.FlyoutPresenterStyle>
                                <Style TargetType="FlyoutPresenter">
                                    <Setter Property="Padding" Value="5"/>
                                    <Setter Property="CornerRadius" Value="8" />
                                </Style>
                            </Flyout.FlyoutPresenterStyle>
                            <StackPanel Orientation="Vertical" Spacing="4">

                                <!-- Total Processed -->
                                <Border CornerRadius="6"
                                        Padding="8,5"
                                        BorderThickness="1"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}">
                                    <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <FontIcon Glyph="&#xE74C;"
                                                  FontSize="12"
                                                  Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                  VerticalAlignment="Center"/>
                                        <TextBlock FontSize="13" VerticalAlignment="Center">
                                            <Run Text="Total:"/>
                                            <Run Text="{x:Bind ViewModel.TotalProcessed, Mode=OneWay}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <!-- Duplicates Count -->
                                <Border CornerRadius="6"
                                        Padding="8,5"
                                        BorderThickness="1"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}">
                                    <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <FontIcon Glyph="&#xE781;"
                                                  FontSize="12"
                                                  Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                                  VerticalAlignment="Center"/>
                                        <TextBlock FontSize="13" VerticalAlignment="Center">
                                            <Run Text="Duplicates:"/>
                                            <Run Text="{x:Bind ViewModel.DuplicateCount, Mode=OneWay}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>

            </Border>

            <!-- Group 5: Similarity -->
            <Border CornerRadius="10"
                    Padding="6,4"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    VerticalAlignment="Center">

                <!-- Similarity Threshold button -->
                <Button x:Uid="SimilarityButton"
                        VerticalAlignment="Center"
                        IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}">

                    <Button.ContentTemplate>
                        <DataTemplate x:DataType="x:String">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE9CA;" FontSize="16"/>
                                <TextBlock Text="{x:Bind}"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>

                    <Button.Flyout>
                        <Flyout>
                            <StackPanel Spacing="10" MaxWidth="350">
                                <TextBlock Text="Similarity Threshold (%)" FontWeight="SemiBold"/>
                                <Slider Minimum="50" Maximum="100"
                                        Value="{x:Bind ViewModel.SimilarityThreshold, Mode=TwoWay}"
                                        Header="{x:Bind ViewModel.SimilarityThreshold, Mode=OneWay}"
                                        TickFrequency="1" TickPlacement="Outside"/>
                                <TextBlock x:Uid="SimilarityDuplicateDescription"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>

            </Border>

            <!-- Group 6: Keep Original strategy -->
            <Border CornerRadius="10"
                    Padding="6,4"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">

                    <!-- Inline label sits flush with the ComboBox, no Header property used -->
                    <TextBlock Text="Keep Original:"
                               FontSize="12"
                               VerticalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                    <!-- Strategy ComboBox -->
                    <ComboBox VerticalAlignment="Center"
                              ItemsSource="{x:Bind ViewModel.SelectionStrategies, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedStrategy, Mode=TwoWay}"
                              IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:SelectionStrategyItem">
                                <TextBlock Text="{x:Bind Name}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                </StackPanel>
            </Border>

        </controls:WrapPanel>

        <!-- Results area: ListView and empty-state placeholder share Grid Row 2 -->
        <Grid Grid.Row="2">

            <!-- Results List -->
            <customUI:ListViewV2 ItemsSource="{x:Bind ViewModel.FilteredDuplicateGroups, Mode=OneWay}"
                                 RegistryKey="DuplicatePhotoFinder"
                                 SelectionMode="None">
                <customUI:ListViewV2.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    </Style>
                </customUI:ListViewV2.ItemContainerStyle>

                <customUI:ListViewV2.ItemTemplate>
                    <DataTemplate x:DataType="core:DuplicateGroup">
                        <Border BorderThickness="0,0,0,1"
                                BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                                Padding="0,12">
                            <Grid ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="300"/>
                                    <!-- Original Column -->
                                    <ColumnDefinition Width="*"/>
                                    <!-- Duplicates Column -->
                                </Grid.ColumnDefinitions>

                                <!-- Left: Original Image -->
                                <StackPanel Grid.Column="0" Spacing="8">
                                    <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                                            CornerRadius="8" Padding="12" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                                        <StackPanel Spacing="8">
                                            <TextBlock Text="ORIGINAL (Kept)"
                                                       FontWeight="Bold"
                                                       Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                                                       HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                            <!-- Image Button -->
                                            <Button Style="{StaticResource ImageButtonStyle}"
                                                    Click="{x:Bind vm:ViewModelProvider.DuplicatePhotoFinderVM.OpenImagePreview}"
                                                    Tag="{x:Bind Original}">
                                                <Image Height="250" Stretch="Uniform">
                                                    <Image.Source>
                                                        <BitmapImage UriSource="{x:Bind Original.FilePath}"
                                                                     DecodePixelHeight="250"/>
                                                    </Image.Source>
                                                </Image>

                                                <!-- Context Menu for deleting original -->
                                                <Button.ContextFlyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem x:Uid="DeleteSingleDuplicateMenuFlyoutItem"
                                                                        Tag="{x:Bind}"
                                                                        Click="{x:Bind vm:ViewModelProvider.DuplicatePhotoFinderVM.DeleteOriginalFile_Click}">
                                                            <MenuFlyoutItem.Icon>
                                                                <FontIcon Glyph="&#xE74D;" Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                                                            </MenuFlyoutItem.Icon>
                                                        </MenuFlyoutItem>
                                                    </MenuFlyout>
                                                </Button.ContextFlyout>
                                            </Button>

                                            <TextBlock Text="{x:Bind Original.FileName}"
                                                       TextWrapping="Wrap"
                                                       MaxLines="1"
                                                       TextTrimming="CharacterEllipsis"
                                                       HorizontalAlignment="Center"
                                                       Style="{StaticResource BodyStrongTextBlockStyle}"
                                                       ToolTipService.ToolTip="{x:Bind Original.FileName}"/>

                                            <!-- Metadata -->
                                            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                                <Border CornerRadius="4" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="6,2">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE737;" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                        <TextBlock Text="{x:Bind Original.ResolutionText}" FontSize="12"/>
                                                    </StackPanel>
                                                </Border>
                                                <Border CornerRadius="4" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="6,2">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE8B9;" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                        <TextBlock Text="{x:Bind Original.FileSizeText}" FontSize="12"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>

                                            <TextBlock Text="{x:Bind Original.FilePath}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       TextWrapping="Wrap"
                                                       MaxLines="1"
                                                       TextTrimming="CharacterEllipsis"
                                                       HorizontalAlignment="Center"
                                                       ToolTipService.ToolTip="{x:Bind Original.FilePath}"/>
                                        </StackPanel>
                                    </Border>

                                    <Button x:Uid="DeleteAllDuplicatesButton"
                                            Tag="{x:Bind}"
                                            Click="{x:Bind vm:ViewModelProvider.DuplicatePhotoFinderVM.DeleteAllDuplicatesInGroup_Click}"
                                            HorizontalAlignment="Stretch"
                                            Style="{StaticResource AccentButtonStyle}"/>
                                </StackPanel>

                                <!-- Right: Duplicates List -->
                                <StackPanel Grid.Column="1" Spacing="8">
                                    <TextBlock Text="DUPLICATES (To be deleted)"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                               Margin="0,0,0,8"/>

                                    <GridView ItemsSource="{x:Bind Duplicates}"
                                              SelectionMode="None"
                                              IsItemClickEnabled="False"
                                              MaxHeight="500"
                                              ScrollViewer.VerticalScrollMode="Auto"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto">

                                        <GridView.ItemTemplate>
                                            <DataTemplate x:DataType="core:DuplicateFile">
                                                <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                                                        BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="8"
                                                        Width="320"
                                                        Margin="0,0,12,12"
                                                        Padding="12">
                                                    <StackPanel Spacing="10">
                                                        <!-- Image Button -->
                                                        <Button Style="{StaticResource ImageButtonStyle}"
                                                                Click="{x:Bind vm:ViewModelProvider.DuplicatePhotoFinderVM.OpenImagePreview}"
                                                                Tag="{x:Bind}">
                                                            <Image Height="220" Stretch="Uniform">
                                                                <Image.Source>
                                                                    <BitmapImage UriSource="{x:Bind FilePath}"
                                                                                 DecodePixelHeight="220"/>
                                                                </Image.Source>
                                                            </Image>
                                                        </Button>

                                                        <TextBlock Text="{x:Bind FileName}"
                                                                   TextWrapping="Wrap"
                                                                   MaxLines="1"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   HorizontalAlignment="Center"
                                                                   Style="{StaticResource BodyStrongTextBlockStyle}"
                                                                   ToolTipService.ToolTip="{x:Bind FileName}"/>

                                                        <!-- Metadata -->
                                                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                                            <Border CornerRadius="4" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="6,2">
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <FontIcon Glyph="&#xE737;" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                                    <TextBlock Text="{x:Bind ResolutionText}" FontSize="12"/>
                                                                </StackPanel>
                                                            </Border>
                                                            <Border CornerRadius="4" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Padding="6,2">
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <FontIcon Glyph="&#xE8B9;" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                                    <TextBlock Text="{x:Bind FileSizeText}" FontSize="12"/>
                                                                </StackPanel>
                                                            </Border>
                                                        </StackPanel>

                                                        <TextBlock Text="{x:Bind FilePath}"
                                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   MaxLines="1"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   HorizontalAlignment="Center"
                                                                   ToolTipService.ToolTip="{x:Bind FilePath}"/>

                                                        <Button x:Uid="DeleteSingleDuplicateButton"
                                                                HorizontalAlignment="Stretch"
                                                                Tag="{x:Bind}"
                                                                Click="{x:Bind vm:ViewModelProvider.DuplicatePhotoFinderVM.DeleteFile_Click}"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </GridView.ItemTemplate>
                                    </GridView>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </customUI:ListViewV2.ItemTemplate>
            </customUI:ListViewV2>

            <!-- Empty-state placeholder -->
            <Border Visibility="{x:Bind ViewModel.EmptyStatePlaceholderVisibility, Mode=OneWay}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    CornerRadius="16"
                    Padding="40,32"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    AllowDrop="{x:Bind ViewModel.IsNotElevated}"
                    DragOver="{x:Bind ViewModel.Grid_DragOver}"
                    Drop="{x:Bind ViewModel.Grid_Drop}">
                <StackPanel Spacing="16" HorizontalAlignment="Center">

                    <!-- Large illustrative icon -->
                    <FontIcon Glyph="&#xEB9F;"
                              FontSize="52"
                              HorizontalAlignment="Center"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>

                    <!-- Primary message -->
                    <TextBlock Text="No results yet"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"/>

                    <!-- Instruction steps -->
                    <StackPanel Spacing="8" HorizontalAlignment="Center">

                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                            <Border CornerRadius="20"
                                    Width="24" Height="24"
                                    Background="{ThemeResource AccentFillColorDefaultBrush}">
                                <TextBlock Text="1"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock x:Uid="DuplicatePhotosFinderEmptySectionTitle"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource BodyTextBlockStyle}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                            <Border CornerRadius="20"
                                    Width="24" Height="24"
                                    Background="{ThemeResource AccentFillColorDefaultBrush}">
                                <TextBlock Text="2"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock x:Uid="DuplicatePhotosFinderEmptySectionDescTwo"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource BodyTextBlockStyle}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                            <Border CornerRadius="20"
                                    Width="24" Height="24"
                                    Background="{ThemeResource AccentFillColorDefaultBrush}">
                                <TextBlock Text="3"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock x:Uid="DuplicatePhotosFinderEmptySectionDescThree"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource BodyTextBlockStyle}"/>
                        </StackPanel>

                    </StackPanel>

                    <!-- Caption hint -->
                    <TextBlock x:Uid="DuplicatePhotosFinderEmptySectionDescFour"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="380"
                               TextAlignment="Center"/>

                    <!-- Drag and Drop hint -->
                    <TextBlock x:Uid="DuplicatePhotosFinderEmptySectionDescFive"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="380"
                               TextAlignment="Center"
                               Margin="0,12,0,0"/>

                </StackPanel>
            </Border>

        </Grid>

    </Grid>
</Page>
